-- Create a staging schema
IF NOT EXISTS (SELECT 1 FROM sys.schemas WHERE name = 'raw')
    EXEC('CREATE SCHEMA raw');
GO

-- PATIENTS
IF OBJECT_ID('raw.patients','U') IS NOT NULL DROP TABLE raw.patients;
CREATE TABLE raw.patients (
    Id UNIQUEIDENTIFIER NOT NULL,
    BIRTHDATE DATE NULL,
    DEATHDATE DATE NULL,
    SSN NVARCHAR(50) NULL,
    DRIVERS NVARCHAR(50) NULL,
    PASSPORT NVARCHAR(50) NULL,
    PREFIX NVARCHAR(50) NULL,
    FIRST NVARCHAR(100) NULL,
    LAST NVARCHAR(100) NULL,
    SUFFIX NVARCHAR(50) NULL,
    MAIDEN NVARCHAR(100) NULL,
    MARITAL NVARCHAR(50) NULL,
    RACE NVARCHAR(50) NULL,
    ETHNICITY NVARCHAR(50) NULL,
    GENDER NVARCHAR(20) NULL,
    BIRTHPLACE NVARCHAR(200) NULL,
    ADDRESS NVARCHAR(200) NULL,
    CITY NVARCHAR(100) NULL,
    STATE NVARCHAR(50) NULL,
    COUNTY NVARCHAR(100) NULL,
    ZIP NVARCHAR(20) NULL,
    LAT FLOAT NULL,
    LON FLOAT NULL,
    HEALTHCARE_EXPENSES DECIMAL(18,2) NULL,
    HEALTHCARE_COVERAGE DECIMAL(18,2) NULL,
    CONSTRAINT PK_raw_patients PRIMARY KEY (Id)
);
GO

-- ORGANIZATIONS
IF OBJECT_ID('raw.organizations','U') IS NOT NULL DROP TABLE raw.organizations;
CREATE TABLE raw.organizations (
    Id UNIQUEIDENTIFIER NOT NULL,
    NAME NVARCHAR(200) NULL,
    ADDRESS NVARCHAR(200) NULL,
    CITY NVARCHAR(100) NULL,
    STATE NVARCHAR(50) NULL,
    ZIP NVARCHAR(20) NULL,
    LAT FLOAT NULL,
    LON FLOAT NULL,
    PHONE NVARCHAR(50) NULL,
    REVENUE DECIMAL(18,2) NULL,
    UTILIZATION INT NULL,
    CONSTRAINT PK_raw_organizations PRIMARY KEY (Id)
);
GO

-- PROVIDERS
IF OBJECT_ID('raw.providers','U') IS NOT NULL DROP TABLE raw.providers;
CREATE TABLE raw.providers (
    Id UNIQUEIDENTIFIER NOT NULL,
    ORGANIZATION UNIQUEIDENTIFIER NULL,
    NAME NVARCHAR(200) NULL,
    GENDER NVARCHAR(20) NULL,
    SPECIALITY NVARCHAR(200) NULL,
    ADDRESS NVARCHAR(200) NULL,
    CITY NVARCHAR(100) NULL,
    STATE NVARCHAR(50) NULL,
    ZIP NVARCHAR(20) NULL,
    LAT FLOAT NULL,
    LON FLOAT NULL,
    UTILIZATION INT NULL,
    CONSTRAINT PK_raw_providers PRIMARY KEY (Id)
);
GO

-- PAYERS
IF OBJECT_ID('raw.payers','U') IS NOT NULL DROP TABLE raw.payers;
CREATE TABLE raw.payers (
    Id UNIQUEIDENTIFIER NOT NULL,
    NAME NVARCHAR(200) NULL,
    ADDRESS NVARCHAR(200) NULL,
    CITY NVARCHAR(100) NULL,
    STATE_HEADQUARTERED NVARCHAR(50) NULL,
    ZIP NVARCHAR(20) NULL,
    PHONE NVARCHAR(50) NULL,
    AMOUNT_COVERED DECIMAL(18,2) NULL,
    AMOUNT_UNCOVERED DECIMAL(18,2) NULL,
    REVENUE DECIMAL(18,2) NULL,
    COVERED_ENCOUNTERS INT NULL,
    UNCOVERED_ENCOUNTERS INT NULL,
    COVERED_MEDICATIONS INT NULL,
    UNCOVERED_MEDICATIONS INT NULL,
    COVERED_PROCEDURES INT NULL,
    UNCOVERED_PROCEDURES INT NULL,
    COVERED_IMMUNIZATIONS INT NULL,
    UNCOVERED_IMMUNIZATIONS INT NULL,
    UNIQUE_CUSTOMERS INT NULL,
    QOLS_AVG DECIMAL(10,4) NULL,
    MEMBER_MONTHS INT NULL,
    CONSTRAINT PK_raw_payers PRIMARY KEY (Id)
);
GO

-- PAYER_TRANSITIONS
IF OBJECT_ID('raw.payer_transitions','U') IS NOT NULL DROP TABLE raw.payer_transitions;
CREATE TABLE raw.payer_transitions (
    PATIENT UNIQUEIDENTIFIER NULL,
    MEMBERID NVARCHAR(100) NULL,
    START DATE NULL,
    STOP DATE NULL,
    PAYER UNIQUEIDENTIFIER NULL,
    SECONDARY_PAYER UNIQUEIDENTIFIER NULL,
    PLAN_OWNERSHIP NVARCHAR(100) NULL,
    OWNER_NAME NVARCHAR(200) NULL
);
GO

-- ENCOUNTERS
IF OBJECT_ID('raw.encounters','U') IS NOT NULL DROP TABLE raw.encounters;
CREATE TABLE raw.encounters (
    Id UNIQUEIDENTIFIER NOT NULL,
    START DATETIME2(0) NULL,
    STOP DATETIME2(0) NULL,
    PATIENT UNIQUEIDENTIFIER NULL,
    ORGANIZATION UNIQUEIDENTIFIER NULL,
    PROVIDER UNIQUEIDENTIFIER NULL,
    PAYER UNIQUEIDENTIFIER NULL,
    ENCOUNTERCLASS NVARCHAR(50) NULL,
    CODE NVARCHAR(50) NULL,
    DESCRIPTION NVARCHAR(200) NULL,
    BASE_ENCOUNTER_COST DECIMAL(18,2) NULL,
    TOTAL_CLAIM_COST DECIMAL(18,2) NULL,
    PAYER_COVERAGE DECIMAL(18,2) NULL,
    REASONCODE NVARCHAR(50) NULL,
    REASONDESCRIPTION NVARCHAR(200) NULL,
    CONSTRAINT PK_raw_encounters PRIMARY KEY (Id)
);
GO

-- CONDITIONS
IF OBJECT_ID('raw.conditions','U') IS NOT NULL DROP TABLE raw.conditions;
CREATE TABLE raw.conditions (
    START DATETIME2(0) NULL,
    STOP DATETIME2(0) NULL,
    PATIENT UNIQUEIDENTIFIER NULL,
    ENCOUNTER UNIQUEIDENTIFIER NULL,
    CODE NVARCHAR(50) NULL,
    DESCRIPTION NVARCHAR(200) NULL
);
GO

-- PROCEDURES
IF OBJECT_ID('raw.procedures','U') IS NOT NULL DROP TABLE raw.procedures;
CREATE TABLE raw.procedures (
    START DATETIME2(0) NULL,
    STOP DATETIME2(0) NULL,
    PATIENT UNIQUEIDENTIFIER NULL,
    ENCOUNTER UNIQUEIDENTIFIER NULL,
    CODE NVARCHAR(50) NULL,
    DESCRIPTION NVARCHAR(200) NULL,
    BASE_COST DECIMAL(18,2) NULL,
    REASONCODE NVARCHAR(50) NULL,
    REASONDESCRIPTION NVARCHAR(200) NULL
);
GO

-- OBSERVATIONS
IF OBJECT_ID('raw.observations','U') IS NOT NULL DROP TABLE raw.observations;
CREATE TABLE raw.observations (
    DATE DATETIME2(0) NULL,
    PATIENT UNIQUEIDENTIFIER NULL,
    ENCOUNTER UNIQUEIDENTIFIER NULL,
    CATEGORY NVARCHAR(100) NULL,
    CODE NVARCHAR(50) NULL,
    DESCRIPTION NVARCHAR(200) NULL,
    VALUE NVARCHAR(200) NULL,
    UNITS NVARCHAR(50) NULL,
    TYPE NVARCHAR(50) NULL
);
GO

-- MEDICATIONS
IF OBJECT_ID('raw.medications','U') IS NOT NULL DROP TABLE raw.medications;
CREATE TABLE raw.medications (
    START DATETIME2(0) NULL,
    STOP DATETIME2(0) NULL,
    PATIENT UNIQUEIDENTIFIER NULL,
    PAYER UNIQUEIDENTIFIER NULL,
    ENCOUNTER UNIQUEIDENTIFIER NULL,
    CODE NVARCHAR(50) NULL,
    DESCRIPTION NVARCHAR(200) NULL,
    BASE_COST DECIMAL(18,2) NULL,
    PAYER_COVERAGE DECIMAL(18,2) NULL,
    DISPENSES INT NULL,
    TOTALCOST DECIMAL(18,2) NULL,
    REASONCODE NVARCHAR(50) NULL,
    REASONDESCRIPTION NVARCHAR(200) NULL
);
GO

-- IMMUNIZATIONS
IF OBJECT_ID('raw.immunizations','U') IS NOT NULL DROP TABLE raw.immunizations;
CREATE TABLE raw.immunizations (
    DATE DATETIME2(0) NULL,
    PATIENT UNIQUEIDENTIFIER NULL,
    ENCOUNTER UNIQUEIDENTIFIER NULL,
    CODE NVARCHAR(50) NULL,
    DESCRIPTION NVARCHAR(200) NULL,
    BASE_COST DECIMAL(18,2) NULL
);
GO

-- ALLERGIES
IF OBJECT_ID('raw.allergies','U') IS NOT NULL DROP TABLE raw.allergies;
CREATE TABLE raw.allergies (
    START DATETIME2(0) NULL,
    STOP DATETIME2(0) NULL,
    PATIENT UNIQUEIDENTIFIER NULL,
    ENCOUNTER UNIQUEIDENTIFIER NULL,
    CODE NVARCHAR(50) NULL,
    DESCRIPTION NVARCHAR(200) NULL
);
GO

-- CAREPLANS
IF OBJECT_ID('raw.careplans','U') IS NOT NULL DROP TABLE raw.careplans;
CREATE TABLE raw.careplans (
    Id UNIQUEIDENTIFIER NULL,
    START DATETIME2(0) NULL,
    STOP DATETIME2(0) NULL,
    PATIENT UNIQUEIDENTIFIER NULL,
    ENCOUNTER UNIQUEIDENTIFIER NULL,
    CODE NVARCHAR(50) NULL,
    DESCRIPTION NVARCHAR(200) NULL,
    REASONCODE NVARCHAR(50) NULL,
    REASONDESCRIPTION NVARCHAR(200) NULL
);
GO

-- DEVICES
IF OBJECT_ID('raw.devices','U') IS NOT NULL DROP TABLE raw.devices;
CREATE TABLE raw.devices (
    START DATETIME2(0) NULL,
    STOP DATETIME2(0) NULL,
    PATIENT UNIQUEIDENTIFIER NULL,
    ENCOUNTER UNIQUEIDENTIFIER NULL,
    CODE NVARCHAR(50) NULL,
    DESCRIPTION NVARCHAR(200) NULL,
    UDI NVARCHAR(200) NULL
);
GO

-- SUPPLIES
IF OBJECT_ID('raw.supplies','U') IS NOT NULL DROP TABLE raw.supplies;
CREATE TABLE raw.supplies (
    DATE DATETIME2(0) NULL,
    PATIENT UNIQUEIDENTIFIER NULL,
    ENCOUNTER UNIQUEIDENTIFIER NULL,
    CODE NVARCHAR(50) NULL,
    DESCRIPTION NVARCHAR(200) NULL,
    QUANTITY INT NULL
);
GO

-- IMAGING_STUDIES
IF OBJECT_ID('raw.imaging_studies','U') IS NOT NULL DROP TABLE raw.imaging_studies;
CREATE TABLE raw.imaging_studies (
    Id UNIQUEIDENTIFIER NULL,
    DATE DATETIME2(0) NULL,
    PATIENT UNIQUEIDENTIFIER NULL,
    ENCOUNTER UNIQUEIDENTIFIER NULL,
    BODYSITE_CODE NVARCHAR(50) NULL,
    BODYSITE_DESCRIPTION NVARCHAR(200) NULL,
    MODALITY_CODE NVARCHAR(50) NULL,
    MODALITY_DESCRIPTION NVARCHAR(200) NULL,
    SOP_CODE NVARCHAR(50) NULL,
    SOP_DESCRIPTION NVARCHAR(200) NULL
);
GO

-- CLAIMS
IF OBJECT_ID('raw.claims','U') IS NOT NULL DROP TABLE raw.claims;
CREATE TABLE raw.claims (
    Id UNIQUEIDENTIFIER NOT NULL,
    PATIENT UNIQUEIDENTIFIER NULL,
    PROVIDER UNIQUEIDENTIFIER NULL,
    PRIMARYPATIENTINSURANCE UNIQUEIDENTIFIER NULL,
    SECONDARYPATIENTINSURANCE UNIQUEIDENTIFIER NULL,
    DEPARTMENTID NVARCHAR(50) NULL,
    PATIENTDEPARTMENTID NVARCHAR(50) NULL,
    DIAGNOSIS1 NVARCHAR(50) NULL,
    DIAGNOSIS2 NVARCHAR(50) NULL,
    DIAGNOSIS3 NVARCHAR(50) NULL,
    DIAGNOSIS4 NVARCHAR(50) NULL,
    DIAGNOSIS5 NVARCHAR(50) NULL,
    DIAGNOSIS6 NVARCHAR(50) NULL,
    DIAGNOSIS7 NVARCHAR(50) NULL,
    DIAGNOSIS8 NVARCHAR(50) NULL,
    REFERRINGPROVIDERID NVARCHAR(50) NULL,
    APPOINTMENTID NVARCHAR(50) NULL,
    CURRENTILLNESSDATE DATE NULL,
    SERVICEDATE DATE NULL,
    SUPERVISINGPROVIDERID NVARCHAR(50) NULL,
    STATUS1 NVARCHAR(50) NULL,
    STATUS2 NVARCHAR(50) NULL,
    STATUSP DATE NULL,
    OUTSTANDING1 DECIMAL(18,2) NULL,
    OUTSTANDING2 DECIMAL(18,2) NULL,
    OUTSTANDINGP DECIMAL(18,2) NULL,
    LASTBILLEDDATE DATE NULL,
    HEALTHCARECLAIMTYPEID1 NVARCHAR(50) NULL,
    HEALTHCARECLAIMTYPEID2 NVARCHAR(50) NULL,
    CONSTRAINT PK_raw_claims PRIMARY KEY (Id)
);
GO

-- CLAIMS_TRANSACTIONS
IF OBJECT_ID('raw.claims_transactions','U') IS NOT NULL DROP TABLE raw.claims_transactions;
CREATE TABLE raw.claims_transactions (
    Id UNIQUEIDENTIFIER NULL,
    CLAIMID UNIQUEIDENTIFIER NULL,
    CHARGETYPE NVARCHAR(50) NULL,
    AMOUNT DECIMAL(18,2) NULL,
    METHOD NVARCHAR(50) NULL,
    FROMDATE DATE NULL,
    TODATE DATE NULL,
    PLACEOFSERVICE NVARCHAR(50) NULL,
    PROCEDURECODE NVARCHAR(50) NULL,
    MODIFIER1 NVARCHAR(50) NULL,
    MODIFIER2 NVARCHAR(50) NULL,
    DIAGNOSISREF1 NVARCHAR(50) NULL,
    DIAGNOSISREF2 NVARCHAR(50) NULL,
    DIAGNOSISREF3 NVARCHAR(50) NULL,
    DIAGNOSISREF4 NVARCHAR(50) NULL,
    UNITS INT NULL,
    DEPARTMENTID NVARCHAR(50) NULL,
    PATIENTDEPARTMENTID NVARCHAR(50) NULL
);
GO
